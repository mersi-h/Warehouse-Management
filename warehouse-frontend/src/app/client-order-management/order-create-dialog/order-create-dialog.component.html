<p-panel>
  <ng-template pTemplate="header">
    <i class="pi pi-receipt"></i>
    <label> {{ isEdit ? 'Edit' : 'New' }} Order </label>
  </ng-template>

  <ng-template pTemplate="content">
    <div class="order-create-container">
      <!-- Item Selection Dropdown -->
      <div class="input-group">
        <div class="title-label">Select Item</div>
        <p-dropdown
          [options]="allItems"
          [(ngModel)]="selectedItem"
          placeholder="Choose an item"
          [style]="{'width': '100%'}"
          optionLabel="itemName"
          appendTo="body"
          [showClear]="true">
        </p-dropdown>
      </div>

      <!-- Quantity Input with Validation -->
      <div class="input-group">
        <div class="title-label">Quantity</div>
        <input type="number" [(ngModel)]="quantity" min="1" placeholder="Enter quantity" class="p-inputtext" style="width: 100%"
               [ngClass]="{'p-invalid': quantity < 1 || quantity === null}" />
        <small *ngIf="quantity < 1 || quantity === null" class="p-error">Please enter a valid quantity</small>
      </div>
      <br/>

      <!-- Add Item Button with Tooltip -->
      <div class="input-group button-group">
        <button pButton label="Add Item" icon="pi pi-plus" (click)="addItem()"
                [disabled]="!selectedItem || quantity < 1" pTooltip="Add selected item to the order"
                tooltipPosition="top" styleClass="p-button-success">
        </button>
      </div>
    </div>
<br/>
    <!-- Order Items Table -->
    <p-table [value]="orderItems">
      <ng-template pTemplate="header">
        <tr>
          <th>Item</th>
          <th>Quantity</th>
          <th>Total Price</th>
          <th>Actions</th>
        </tr>
      </ng-template>
      <ng-template pTemplate="body" let-item>
        <tr>
          <td>{{ item.item?.itemName }}</td>

          <!-- Editable Quantity Column -->
          <td>
            <input
              type="number"
              [(ngModel)]="item.quantity"
              (ngModelChange)="modifyItemQuantity(item, $event)"
              min="1"
              placeholder="Quantity"/>
          </td>

          <!-- Total Price Column -->
          <td>{{ item.totalPrice | currency }}</td>

          <!-- Actions Column -->
          <td>
            <button pButton icon="pi pi-trash" (click)="removeItem(item)" class="p-button-danger"></button>
          </td>
        </tr>
      </ng-template>
    </p-table>
  </ng-template>

  <p-footer>
    <div style="text-align: end;">
      <button style="margin-right: 0.3rem; background: #466FB5;border-color: #466FB5;box-shadow: #B5C5E1"
              pButton label="Save Order" icon="pi pi-check" (click)="saveOrder()"></button>
      <button pButton label="Cancel" icon="pi pi-times" (click)="closeDialog()"></button>
    </div>
  </p-footer>
</p-panel>
